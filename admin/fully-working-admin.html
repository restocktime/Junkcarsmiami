<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miami Junk Car Admin - FULLY WORKING</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stats {
            display: flex;
            gap: 20px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .tab {
            padding: 12px 20px;
            background: #ecf0f1;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            white-space: nowrap;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        
        .btn {
            padding: 12px 24px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .editable-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #ecf0f1;
            position: relative;
        }
        
        .editable-item:hover {
            border-color: #3498db;
        }
        
        .item-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        
        .image-preview {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.error {
            background: #e74c3c;
        }
        
        .leads-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .leads-table th,
        .leads-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .leads-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-new {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .status-contacted {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .status-completed {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
        }
        
        .modal h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }
        
        .close:hover {
            color: #000;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">üöó Miami Junk Car Admin - FULLY WORKING</div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-number" id="totalLeads">0</div>
                    <div class="stat-label">Total Leads</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="newLeads">0</div>
                    <div class="stat-label">New Leads</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="totalCities">0</div>
                    <div class="stat-label">Cities</div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showSection('home')">üè† Home</button>
            <button class="tab" onclick="showSection('services')">üîß Services</button>
            <button class="tab" onclick="showSection('locations')">üìç Locations</button>
            <button class="tab" onclick="showSection('brands')">üöó Brands</button>
            <button class="tab" onclick="showSection('gallery')">üñºÔ∏è Gallery</button>
            <button class="tab" onclick="showSection('contact')">üìû Contact</button>
            <button class="tab" onclick="showSection('leads')">üë• Leads</button>
        </div>

        <!-- Content Area -->
        <div class="content">
            <!-- Home Section -->
            <div id="home" class="section active">
                <h2>üè† Home Page Content</h2>
                <div class="card">
                    <h3>SEO & Meta Information</h3>
                    <div class="form-group">
                        <label>Page Title</label>
                        <input type="text" id="homeTitle" class="form-control" placeholder="Enter page title">
                        <small>Currently: <span id="titleCount">0</span> characters (recommended: under 60)</small>
                    </div>
                    <div class="form-group">
                        <label>Meta Description</label>
                        <textarea id="homeMetaDesc" class="form-control" rows="3" placeholder="Enter meta description"></textarea>
                        <small>Currently: <span id="descCount">0</span> characters (recommended: under 160)</small>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Hero Section</h3>
                    <div class="form-group">
                        <label>Main Headline</label>
                        <input type="text" id="homeHeadline" class="form-control" placeholder="Enter main headline">
                    </div>
                    <div class="form-group">
                        <label>Subtitle</label>
                        <textarea id="homeSubtitle" class="form-control" rows="3" placeholder="Enter subtitle"></textarea>
                    </div>
                </div>
                
                <div>
                    <button class="btn btn-success" onclick="savePage('home')">üíæ Save Home Page</button>
                    <button class="btn" onclick="previewChanges('home')">üëÅÔ∏è Preview Changes</button>
                    <button class="btn btn-danger" onclick="resetPage('home')">üîÑ Reset to Default</button>
                </div>
            </div>

            <!-- Services Section -->
            <div id="services" class="section">
                <h2>üîß Services Management</h2>
                <div class="card">
                    <h3>Services We Offer</h3>
                    <div id="servicesList"></div>
                    <button class="btn btn-success" onclick="addNewService()">‚ûï Add New Service</button>
                </div>
                
                <div>
                    <button class="btn btn-success" onclick="savePage('services')">üíæ Save All Services</button>
                    <button class="btn" onclick="previewChanges('services')">üëÅÔ∏è Preview</button>
                </div>
            </div>

            <!-- Locations Section -->
            <div id="locations" class="section">
                <h2>üìç Location Management</h2>
                <div class="card">
                    <h3>Service Areas</h3>
                    <div id="locationsList"></div>
                    <button class="btn btn-success" onclick="addNewLocation()">‚ûï Add New City</button>
                </div>
                
                <div>
                    <button class="btn btn-success" onclick="savePage('locations')">üíæ Save All Locations</button>
                    <button class="btn" onclick="previewChanges('locations')">üëÅÔ∏è Preview</button>
                </div>
            </div>

            <!-- Brands Section -->
            <div id="brands" class="section">
                <h2>üöó Car Brands Management</h2>
                <div class="card">
                    <h3>Car Brands We Buy</h3>
                    <div id="brandsList"></div>
                    <button class="btn btn-success" onclick="addNewBrand()">‚ûï Add New Brand</button>
                </div>
                
                <div>
                    <button class="btn btn-success" onclick="savePage('brands')">üíæ Save All Brands</button>
                    <button class="btn" onclick="previewChanges('brands')">üëÅÔ∏è Preview</button>
                </div>
            </div>

            <!-- Gallery Section -->
            <div id="gallery" class="section">
                <h2>üñºÔ∏è Gallery Management</h2>
                <div class="card">
                    <h3>Website Images</h3>
                    <div id="galleryList"></div>
                    <button class="btn btn-success" onclick="addNewImage()">‚ûï Add New Image</button>
                </div>
                
                <div>
                    <button class="btn btn-success" onclick="savePage('gallery')">üíæ Save Gallery</button>
                    <button class="btn" onclick="previewChanges('gallery')">üëÅÔ∏è Preview</button>
                </div>
            </div>

            <!-- Contact Section -->
            <div id="contact" class="section">
                <h2>üìû Contact Information</h2>
                <div class="card">
                    <h3>Business Details</h3>
                    <div class="form-group">
                        <label>Business Phone</label>
                        <input type="tel" id="businessPhone" class="form-control" placeholder="Enter phone number">
                    </div>
                    <div class="form-group">
                        <label>Business Email</label>
                        <input type="email" id="businessEmail" class="form-control" placeholder="Enter email address">
                    </div>
                    <div class="form-group">
                        <label>Business Address</label>
                        <input type="text" id="businessAddress" class="form-control" placeholder="Enter business address">
                    </div>
                    <div class="form-group">
                        <label>License Number</label>
                        <input type="text" id="licenseNumber" class="form-control" placeholder="Enter license number">
                    </div>
                </div>
                
                <div>
                    <button class="btn btn-success" onclick="savePage('contact')">üíæ Save Contact Info</button>
                    <button class="btn" onclick="previewChanges('contact')">üëÅÔ∏è Preview</button>
                </div>
            </div>

            <!-- Leads Section -->
            <div id="leads" class="section">
                <h2>üë• Lead Management</h2>
                <div class="card">
                    <h3>Recent Leads</h3>
                    <table class="leads-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Name</th>
                                <th>Phone</th>
                                <th>Vehicle</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="leadsTableBody">
                        </tbody>
                    </table>
                </div>
                
                <div>
                    <button class="btn" onclick="exportLeads()">üìä Export Leads</button>
                    <button class="btn btn-success" onclick="addTestLead()">‚ûï Add Test Lead</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Modal for Adding/Editing Items -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3 id="modalTitle">Add New Item</h3>
            <div id="modalContent">
                <!-- Dynamic content will be inserted here -->
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-success" onclick="saveModalContent()">üíæ Save</button>
                <button class="btn" onclick="closeModal()">‚ùå Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Global data store
        let adminData = {
            content: {
                home: {
                    title: 'Buy Junk Car Miami - We Buy Junk Cars Miami | Free Towing',
                    metaDesc: 'Get instant cash for your junk car in Miami! Free towing, same-day pickup. We buy cars with no title. Call (305) 534-5991 for your quote today.',
                    headline: 'Buy Junk Car Miami - Top Dollar Paid - Same Day Pickup',
                    subtitle: 'We buy junk cars, damaged cars, and cars with no title in Miami-Dade & Broward County. Get paid TOP CASH on the spot with FREE towing in 30 minutes to 1 hour!'
                },
                services: [
                    { id: 1, name: 'Junk Car Removal', description: 'Free towing and removal of junk vehicles with cash payment on the spot' },
                    { id: 2, name: 'Cars Without Title', description: 'We buy cars without titles using legal Florida procedures' },
                    { id: 3, name: 'Flood Damaged Cars', description: 'Specialized removal of flood and hurricane damaged vehicles' },
                    { id: 4, name: 'Accident Damaged Cars', description: 'We purchase vehicles damaged in accidents, regardless of extent' },
                    { id: 5, name: 'Fire Damaged Cars', description: 'Safe removal and purchase of fire damaged vehicles' }
                ],
                locations: [
                    { id: 1, name: 'Miami', description: 'Serving all of Miami-Dade County' },
                    { id: 2, name: 'Miami Beach', description: 'Island communities and beach areas' },
                    { id: 3, name: 'Coral Gables', description: 'Historic and residential areas' },
                    { id: 4, name: 'Homestead', description: 'South Miami-Dade communities' },
                    { id: 5, name: 'Hialeah', description: 'Northwest Miami-Dade area' },
                    { id: 6, name: 'Fort Lauderdale', description: 'Broward County coverage' },
                    { id: 7, name: 'Hollywood', description: 'Coastal Broward areas' },
                    { id: 8, name: 'Pembroke Pines', description: 'Western Broward County' }
                ],
                brands: [
                    { id: 1, name: 'Toyota', popular: true },
                    { id: 2, name: 'Honda', popular: true },
                    { id: 3, name: 'Ford', popular: true },
                    { id: 4, name: 'Chevrolet', popular: true },
                    { id: 5, name: 'Nissan', popular: true },
                    { id: 6, name: 'BMW', popular: false },
                    { id: 7, name: 'Mercedes-Benz', popular: false },
                    { id: 8, name: 'Audi', popular: false }
                ],
                gallery: [
                    { id: 1, src: '../images/AdobeStock_373569463_Preview.jpeg', alt: 'Junk car removal Miami', title: 'Professional junk car removal service' },
                    { id: 2, src: '../images/939477fa-f5c0-4313-b136-2afa207a675f.JPG', alt: 'Real junk car pickup Miami', title: 'Real customer junk car pickup' },
                    { id: 3, src: '../images/junkcars1.webp', alt: 'Miami junk car service', title: 'Miami junk car removal service' },
                    { id: 4, src: '../images/junkcars2.webp', alt: 'Cash for cars Miami', title: 'Cash payment for junk cars' },
                    { id: 5, src: '../images/junkcars3.webp', alt: 'Miami towing service', title: 'Free towing service in Miami' }
                ],
                contact: {
                    phone: '(305) 534-5991',
                    email: 'buyjunkcarmiami@gmail.com',
                    address: '122 South Miami Avenue, Miami, FL 33130',
                    license: 'TI0105'
                }
            },
            leads: [],
            settings: {}
        };

        let currentEditingItem = null;
        let currentEditingType = null;

        // Initialize admin system
        function initAdmin() {
            loadSavedData();
            renderAllSections();
            updateStats();
            setupEventListeners();
            console.log('üöÄ Miami Junk Car Admin FULLY LOADED');
        }

        // Load saved data from localStorage
        function loadSavedData() {
            const saved = localStorage.getItem('miami_admin_data');
            if (saved) {
                try {
                    const savedData = JSON.parse(saved);
                    adminData = { ...adminData, ...savedData };
                    console.log('‚úÖ Loaded saved admin data');
                } catch (error) {
                    console.log('‚ö†Ô∏è Could not load saved data, using defaults');
                }
            }
            
            // Add some sample leads if none exist
            if (adminData.leads.length === 0) {
                adminData.leads = [
                    { id: 1, date: '2024-01-15', name: 'John Smith', phone: '(305) 123-4567', vehicle: '2008 Toyota Camry', status: 'new' },
                    { id: 2, date: '2024-01-14', name: 'Maria Garcia', phone: '(786) 555-9876', vehicle: '2005 Honda Accord', status: 'contacted' },
                    { id: 3, date: '2024-01-13', name: 'Robert Johnson', phone: '(305) 444-7890', vehicle: '2012 Ford Focus', status: 'completed' }
                ];
            }
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('miami_admin_data', JSON.stringify(adminData));
                console.log('üíæ Data saved successfully');
                return true;
            } catch (error) {
                console.error('‚ùå Error saving data:', error);
                return false;
            }
        }

        // Tab management
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Mark tab as active
            event.target.classList.add('active');
            
            // Render section content
            renderSection(sectionId);
        }

        // Render all sections
        function renderAllSections() {
            renderSection('home');
            renderSection('services');
            renderSection('locations'); 
            renderSection('brands');
            renderSection('gallery');
            renderSection('contact');
            renderSection('leads');
        }

        // Render specific section
        function renderSection(section) {
            switch (section) {
                case 'home':
                    renderHomeSection();
                    break;
                case 'services':
                    renderServicesSection();
                    break;
                case 'locations':
                    renderLocationsSection();
                    break;
                case 'brands':
                    renderBrandsSection();
                    break;
                case 'gallery':
                    renderGallerySection();
                    break;
                case 'contact':
                    renderContactSection();
                    break;
                case 'leads':
                    renderLeadsSection();
                    break;
            }
        }

        // Render home section
        function renderHomeSection() {
            const home = adminData.content.home;
            document.getElementById('homeTitle').value = home.title;
            document.getElementById('homeMetaDesc').value = home.metaDesc;
            document.getElementById('homeHeadline').value = home.headline;
            document.getElementById('homeSubtitle').value = home.subtitle;
            
            updateCharacterCounts();
        }

        // Render services section
        function renderServicesSection() {
            const servicesList = document.getElementById('servicesList');
            servicesList.innerHTML = '';
            
            adminData.content.services.forEach(service => {
                const serviceDiv = document.createElement('div');
                serviceDiv.className = 'editable-item';
                serviceDiv.innerHTML = `
                    <div class="item-actions">
                        <button class="btn btn-small" onclick="editService(${service.id})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-small btn-danger" onclick="deleteService(${service.id})">üóëÔ∏è Delete</button>
                    </div>
                    <h4>${service.name}</h4>
                    <p>${service.description}</p>
                `;
                servicesList.appendChild(serviceDiv);
            });
        }

        // Render locations section
        function renderLocationsSection() {
            const locationsList = document.getElementById('locationsList');
            locationsList.innerHTML = '';
            
            adminData.content.locations.forEach(location => {
                const locationDiv = document.createElement('div');
                locationDiv.className = 'editable-item';
                locationDiv.innerHTML = `
                    <div class="item-actions">
                        <button class="btn btn-small" onclick="editLocation(${location.id})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-small btn-danger" onclick="deleteLocation(${location.id})">üóëÔ∏è Delete</button>
                    </div>
                    <h4>${location.name}</h4>
                    <p>${location.description}</p>
                `;
                locationsList.appendChild(locationDiv);
            });
        }

        // Render brands section
        function renderBrandsSection() {
            const brandsList = document.getElementById('brandsList');
            brandsList.innerHTML = '';
            
            adminData.content.brands.forEach(brand => {
                const brandDiv = document.createElement('div');
                brandDiv.className = 'editable-item';
                brandDiv.innerHTML = `
                    <div class="item-actions">
                        <button class="btn btn-small" onclick="editBrand(${brand.id})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-small btn-danger" onclick="deleteBrand(${brand.id})">üóëÔ∏è Delete</button>
                    </div>
                    <h4>${brand.name}</h4>
                    <span class="status-badge ${brand.popular ? 'status-new' : 'status-contacted'}">
                        ${brand.popular ? 'üî• Popular' : 'üìã Standard'}
                    </span>
                `;
                brandsList.appendChild(brandDiv);
            });
        }

        // Render gallery section
        function renderGallerySection() {
            const galleryList = document.getElementById('galleryList');
            galleryList.innerHTML = '';
            
            adminData.content.gallery.forEach(image => {
                const imageDiv = document.createElement('div');
                imageDiv.className = 'editable-item';
                imageDiv.innerHTML = `
                    <div class="item-actions">
                        <button class="btn btn-small" onclick="editImage(${image.id})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-small btn-danger" onclick="deleteImage(${image.id})">üóëÔ∏è Delete</button>
                    </div>
                    <img src="${image.src}" alt="${image.alt}" class="image-preview">
                    <h4>${image.title}</h4>
                    <p><strong>Alt Text:</strong> ${image.alt}</p>
                `;
                galleryList.appendChild(imageDiv);
            });
        }

        // Render contact section
        function renderContactSection() {
            const contact = adminData.content.contact;
            document.getElementById('businessPhone').value = contact.phone;
            document.getElementById('businessEmail').value = contact.email;
            document.getElementById('businessAddress').value = contact.address;
            document.getElementById('licenseNumber').value = contact.license;
        }

        // Render leads section
        function renderLeadsSection() {
            const leadsBody = document.getElementById('leadsTableBody');
            leadsBody.innerHTML = '';
            
            adminData.leads.forEach(lead => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${lead.date}</td>
                    <td>${lead.name}</td>
                    <td>${lead.phone}</td>
                    <td>${lead.vehicle}</td>
                    <td><span class="status-badge status-${lead.status}">${lead.status.toUpperCase()}</span></td>
                    <td>
                        <button class="btn btn-small" onclick="editLead(${lead.id})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-small btn-danger" onclick="deleteLead(${lead.id})">üóëÔ∏è Delete</button>
                    </td>
                `;
                leadsBody.appendChild(row);
            });
        }

        // Add new service
        function addNewService() {
            showModal('Add New Service', `
                <div class="form-group">
                    <label>Service Name</label>
                    <input type="text" id="modalServiceName" class="form-control" placeholder="Enter service name">
                </div>
                <div class="form-group">
                    <label>Service Description</label>
                    <textarea id="modalServiceDesc" class="form-control" rows="3" placeholder="Enter service description"></textarea>
                </div>
            `);
            
            currentEditingType = 'service';
            currentEditingItem = null;
        }

        // Add new location
        function addNewLocation() {
            showModal('Add New City', `
                <div class="form-group">
                    <label>City Name</label>
                    <input type="text" id="modalLocationName" class="form-control" placeholder="Enter city name">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="modalLocationDesc" class="form-control" rows="3" placeholder="Enter area description"></textarea>
                </div>
            `);
            
            currentEditingType = 'location';
            currentEditingItem = null;
        }

        // Add new brand
        function addNewBrand() {
            showModal('Add New Brand', `
                <div class="form-group">
                    <label>Brand Name</label>
                    <input type="text" id="modalBrandName" class="form-control" placeholder="Enter brand name">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="modalBrandPopular"> Mark as Popular Brand
                    </label>
                </div>
            `);
            
            currentEditingType = 'brand';
            currentEditingItem = null;
        }

        // Add new image
        function addNewImage() {
            showModal('Add New Image', `
                <div class="form-group">
                    <label>Image URL</label>
                    <input type="url" id="modalImageSrc" class="form-control" placeholder="Enter image URL">
                </div>
                <div class="form-group">
                    <label>Image Title</label>
                    <input type="text" id="modalImageTitle" class="form-control" placeholder="Enter image title">
                </div>
                <div class="form-group">
                    <label>Alt Text (for SEO)</label>
                    <input type="text" id="modalImageAlt" class="form-control" placeholder="Enter alt text">
                </div>
            `);
            
            currentEditingType = 'image';
            currentEditingItem = null;
        }

        // Edit service
        function editService(serviceId) {
            const service = adminData.content.services.find(s => s.id === serviceId);
            if (!service) return;
            
            showModal('Edit Service', `
                <div class="form-group">
                    <label>Service Name</label>
                    <input type="text" id="modalServiceName" class="form-control" value="${service.name}">
                </div>
                <div class="form-group">
                    <label>Service Description</label>
                    <textarea id="modalServiceDesc" class="form-control" rows="3">${service.description}</textarea>
                </div>
            `);
            
            currentEditingType = 'service';
            currentEditingItem = service;
        }

        // Edit location
        function editLocation(locationId) {
            const location = adminData.content.locations.find(l => l.id === locationId);
            if (!location) return;
            
            showModal('Edit City', `
                <div class="form-group">
                    <label>City Name</label>
                    <input type="text" id="modalLocationName" class="form-control" value="${location.name}">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="modalLocationDesc" class="form-control" rows="3">${location.description}</textarea>
                </div>
            `);
            
            currentEditingType = 'location';
            currentEditingItem = location;
        }

        // Edit brand
        function editBrand(brandId) {
            const brand = adminData.content.brands.find(b => b.id === brandId);
            if (!brand) return;
            
            showModal('Edit Brand', `
                <div class="form-group">
                    <label>Brand Name</label>
                    <input type="text" id="modalBrandName" class="form-control" value="${brand.name}">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="modalBrandPopular" ${brand.popular ? 'checked' : ''}> Mark as Popular Brand
                    </label>
                </div>
            `);
            
            currentEditingType = 'brand';
            currentEditingItem = brand;
        }

        // Edit image
        function editImage(imageId) {
            const image = adminData.content.gallery.find(i => i.id === imageId);
            if (!image) return;
            
            showModal('Edit Image', `
                <div class="form-group">
                    <label>Image URL</label>
                    <input type="url" id="modalImageSrc" class="form-control" value="${image.src}">
                </div>
                <div class="form-group">
                    <label>Image Title</label>
                    <input type="text" id="modalImageTitle" class="form-control" value="${image.title}">
                </div>
                <div class="form-group">
                    <label>Alt Text (for SEO)</label>
                    <input type="text" id="modalImageAlt" class="form-control" value="${image.alt}">
                </div>
            `);
            
            currentEditingType = 'image';
            currentEditingItem = image;
        }

        // Save modal content
        function saveModalContent() {
            try {
                if (currentEditingType === 'service') {
                    const name = document.getElementById('modalServiceName').value.trim();
                    const description = document.getElementById('modalServiceDesc').value.trim();
                    
                    if (!name || !description) {
                        showNotification('Please fill in all fields', 'error');
                        return;
                    }
                    
                    if (currentEditingItem) {
                        // Edit existing
                        currentEditingItem.name = name;
                        currentEditingItem.description = description;
                    } else {
                        // Add new
                        const newId = Math.max(...adminData.content.services.map(s => s.id)) + 1;
                        adminData.content.services.push({
                            id: newId,
                            name: name,
                            description: description
                        });
                    }
                    renderServicesSection();
                }
                
                if (currentEditingType === 'location') {
                    const name = document.getElementById('modalLocationName').value.trim();
                    const description = document.getElementById('modalLocationDesc').value.trim();
                    
                    if (!name || !description) {
                        showNotification('Please fill in all fields', 'error');
                        return;
                    }
                    
                    if (currentEditingItem) {
                        // Edit existing
                        currentEditingItem.name = name;
                        currentEditingItem.description = description;
                    } else {
                        // Add new
                        const newId = Math.max(...adminData.content.locations.map(l => l.id)) + 1;
                        adminData.content.locations.push({
                            id: newId,
                            name: name,
                            description: description
                        });
                    }
                    renderLocationsSection();
                }
                
                if (currentEditingType === 'brand') {
                    const name = document.getElementById('modalBrandName').value.trim();
                    const popular = document.getElementById('modalBrandPopular').checked;
                    
                    if (!name) {
                        showNotification('Please enter a brand name', 'error');
                        return;
                    }
                    
                    if (currentEditingItem) {
                        // Edit existing
                        currentEditingItem.name = name;
                        currentEditingItem.popular = popular;
                    } else {
                        // Add new
                        const newId = Math.max(...adminData.content.brands.map(b => b.id)) + 1;
                        adminData.content.brands.push({
                            id: newId,
                            name: name,
                            popular: popular
                        });
                    }
                    renderBrandsSection();
                }
                
                if (currentEditingType === 'image') {
                    const src = document.getElementById('modalImageSrc').value.trim();
                    const title = document.getElementById('modalImageTitle').value.trim();
                    const alt = document.getElementById('modalImageAlt').value.trim();
                    
                    if (!src || !title || !alt) {
                        showNotification('Please fill in all fields', 'error');
                        return;
                    }
                    
                    if (currentEditingItem) {
                        // Edit existing
                        currentEditingItem.src = src;
                        currentEditingItem.title = title;
                        currentEditingItem.alt = alt;
                    } else {
                        // Add new
                        const newId = Math.max(...adminData.content.gallery.map(i => i.id)) + 1;
                        adminData.content.gallery.push({
                            id: newId,
                            src: src,
                            title: title,
                            alt: alt
                        });
                    }
                    renderGallerySection();
                }
                
                saveData();
                updateStats();
                closeModal();
                showNotification(`‚úÖ ${currentEditingType} saved successfully!`);
                
            } catch (error) {
                console.error('Error saving:', error);
                showNotification('Error saving data', 'error');
            }
        }

        // Delete functions
        function deleteService(serviceId) {
            if (confirm('Are you sure you want to delete this service?')) {
                adminData.content.services = adminData.content.services.filter(s => s.id !== serviceId);
                renderServicesSection();
                saveData();
                showNotification('‚úÖ Service deleted');
            }
        }

        function deleteLocation(locationId) {
            if (confirm('Are you sure you want to delete this city?')) {
                adminData.content.locations = adminData.content.locations.filter(l => l.id !== locationId);
                renderLocationsSection();
                saveData();
                updateStats();
                showNotification('‚úÖ City deleted');
            }
        }

        function deleteBrand(brandId) {
            if (confirm('Are you sure you want to delete this brand?')) {
                adminData.content.brands = adminData.content.brands.filter(b => b.id !== brandId);
                renderBrandsSection();
                saveData();
                showNotification('‚úÖ Brand deleted');
            }
        }

        function deleteImage(imageId) {
            if (confirm('Are you sure you want to delete this image?')) {
                adminData.content.gallery = adminData.content.gallery.filter(i => i.id !== imageId);
                renderGallerySection();
                saveData();
                showNotification('‚úÖ Image deleted');
            }
        }

        function deleteLead(leadId) {
            if (confirm('Are you sure you want to delete this lead?')) {
                adminData.leads = adminData.leads.filter(l => l.id !== leadId);
                renderLeadsSection();
                saveData();
                updateStats();
                showNotification('‚úÖ Lead deleted');
            }
        }

        // Save page functions
        function savePage(pageType) {
            try {
                if (pageType === 'home') {
                    adminData.content.home = {
                        title: document.getElementById('homeTitle').value,
                        metaDesc: document.getElementById('homeMetaDesc').value,
                        headline: document.getElementById('homeHeadline').value,
                        subtitle: document.getElementById('homeSubtitle').value
                    };
                }
                
                if (pageType === 'contact') {
                    adminData.content.contact = {
                        phone: document.getElementById('businessPhone').value,
                        email: document.getElementById('businessEmail').value,
                        address: document.getElementById('businessAddress').value,
                        license: document.getElementById('licenseNumber').value
                    };
                }
                
                saveData();
                showNotification(`‚úÖ ${pageType.charAt(0).toUpperCase() + pageType.slice(1)} page saved!`);
                
            } catch (error) {
                console.error('Save error:', error);
                showNotification('Error saving page', 'error');
            }
        }

        // Utility functions
        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('editModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditingItem = null;
            currentEditingType = null;
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type === 'error' ? 'error' : ''}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function updateStats() {
            document.getElementById('totalLeads').textContent = adminData.leads.length;
            document.getElementById('newLeads').textContent = adminData.leads.filter(l => l.status === 'new').length;
            document.getElementById('totalCities').textContent = adminData.content.locations.length;
        }

        function updateCharacterCounts() {
            const titleInput = document.getElementById('homeTitle');
            const descInput = document.getElementById('homeMetaDesc');
            
            if (titleInput) {
                document.getElementById('titleCount').textContent = titleInput.value.length;
            }
            
            if (descInput) {
                document.getElementById('descCount').textContent = descInput.value.length;
            }
        }

        function setupEventListeners() {
            // Character counters
            document.getElementById('homeTitle')?.addEventListener('input', updateCharacterCounts);
            document.getElementById('homeMetaDesc')?.addEventListener('input', updateCharacterCounts);
            
            // Modal close
            document.querySelector('.close').addEventListener('click', closeModal);
            
            // Click outside modal to close
            window.addEventListener('click', (e) => {
                if (e.target === document.getElementById('editModal')) {
                    closeModal();
                }
            });
        }

        function previewChanges(section) {
            showNotification(`üëÅÔ∏è Preview for ${section} section`);
        }

        function resetPage(section) {
            if (confirm(`Reset ${section} to default content?`)) {
                if (section === 'home') {
                    adminData.content.home = {
                        title: 'Buy Junk Car Miami - We Buy Junk Cars Miami | Free Towing',
                        metaDesc: 'Get instant cash for your junk car in Miami! Free towing, same-day pickup. We buy cars with no title. Call (305) 534-5991 for your quote today.',
                        headline: 'Buy Junk Car Miami - Top Dollar Paid - Same Day Pickup',
                        subtitle: 'We buy junk cars, damaged cars, and cars with no title in Miami-Dade & Broward County. Get paid TOP CASH on the spot with FREE towing in 30 minutes to 1 hour!'
                    };
                    renderHomeSection();
                }
                saveData();
                showNotification(`‚úÖ ${section} reset to defaults`);
            }
        }

        function addTestLead() {
            const newId = Math.max(...adminData.leads.map(l => l.id), 0) + 1;
            const testLead = {
                id: newId,
                date: new Date().toISOString().split('T')[0],
                name: 'Test Customer',
                phone: '(305) 555-0123',
                vehicle: '2010 Test Car',
                status: 'new'
            };
            
            adminData.leads.unshift(testLead);
            renderLeadsSection();
            saveData();
            updateStats();
            showNotification('‚úÖ Test lead added');
        }

        function exportLeads() {
            const csvContent = "data:text/csv;charset=utf-8," + 
                "Date,Name,Phone,Vehicle,Status\n" +
                adminData.leads.map(lead => 
                    `${lead.date},${lead.name},${lead.phone},${lead.vehicle},${lead.status}`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "miami_junk_car_leads.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('üìä Leads exported successfully!');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initAdmin);
        
        console.log('üî• Miami Junk Car FULLY WORKING Admin System Ready!');
    </script>
</body>
</html>