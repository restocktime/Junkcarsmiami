<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miami Junk Car Admin - Working System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stats {
            display: flex;
            gap: 20px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .tab {
            padding: 12px 20px;
            background: #ecf0f1;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            white-space: nowrap;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tab:hover {
            background: #34495e;
            color: white;
        }
        
        .content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        
        .form-control.changed {
            border-left: 4px solid #f39c12;
            background: #fffbf0;
        }
        
        .form-control.saved {
            border-left: 4px solid #27ae60;
            background: #f0fff4;
        }
        
        .editing-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #f39c12;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
            display: none;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .btn {
            padding: 12px 24px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .leads-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .leads-table th,
        .leads-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .leads-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .status-new {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .status-contacted {
            background: #fff3e0;
            color: #f57c00;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .image-preview {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        
        .actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">üöó Miami Junk Car Admin</div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-number" id="totalLeads">0</div>
                    <div class="stat-label">Total Leads</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="newLeads">0</div>
                    <div class="stat-label">New Leads</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="todayLeads">0</div>
                    <div class="stat-label">Today</div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showSection('home')">üè† Home</button>
            <button class="tab" onclick="showSection('services')">üîß Services</button>
            <button class="tab" onclick="showSection('locations')">üìç Locations</button>
            <button class="tab" onclick="showSection('brands')">üöó Brands</button>
            <button class="tab" onclick="showSection('gallery')">üñºÔ∏è Gallery</button>
            <button class="tab" onclick="showSection('contact')">üìû Contact</button>
            <button class="tab" onclick="showSection('leads')">üë• Leads</button>
            <button class="tab" onclick="showSection('forms')">üìã Forms</button>
        </div>

        <!-- Content Area -->
        <div class="content">
            <!-- Home Section -->
            <div id="home" class="section active">
                <h2>üè† Home Page Content</h2>
                <div class="card">
                    <h3>SEO & Meta Information</h3>
                    <div class="form-group">
                        <label>Page Title</label>
                        <input type="text" id="homeTitle" class="form-control" value="Buy Junk Car Miami - We Buy Junk Cars Miami | Free Towing">
                    </div>
                    <div class="form-group">
                        <label>Meta Description</label>
                        <textarea id="homeMetaDesc" class="form-control" rows="3">Get instant cash for your junk car in Miami! Free towing, same-day pickup. We buy cars with no title. Call (305) 534-5991 for your quote today.</textarea>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Hero Section</h3>
                    <div class="form-group">
                        <label>Main Headline</label>
                        <input type="text" id="homeHeadline" class="form-control" value="Buy Junk Car Miami - Top Dollar Paid - Same Day Pickup">
                    </div>
                    <div class="form-group">
                        <label>Subtitle</label>
                        <textarea id="homeSubtitle" class="form-control" rows="3">We buy junk cars, damaged cars, and cars with no title in Miami-Dade & Broward County. Get paid TOP CASH on the spot with FREE towing in 30 minutes to 1 hour!</textarea>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-success" onclick="savePage('home')">üíæ Save Home Page</button>
                    <button class="btn" onclick="previewPage('home')">üëÅÔ∏è Preview</button>
                    <a href="/" target="_blank" class="btn">üåê View Live</a>
                    <button class="btn" onclick="resetPage('home')" style="background: #e74c3c;">üîÑ Reset</button>
                </div>
            </div>

            <!-- Services Section -->
            <div id="services" class="section">
                <h2>üîß Services Content</h2>
                <div class="card">
                    <h3>Services We Offer</h3>
                    <div class="grid" id="servicesList">
                        <div class="card">
                            <h4>Junk Car Removal</h4>
                            <div class="form-group">
                                <textarea class="form-control" rows="3">Free towing and removal of junk vehicles with cash payment on the spot</textarea>
                            </div>
                        </div>
                        <div class="card">
                            <h4>Cars Without Title</h4>
                            <div class="form-group">
                                <textarea class="form-control" rows="3">We buy cars without titles using legal Florida procedures</textarea>
                            </div>
                        </div>
                        <div class="card">
                            <h4>Flood Damaged Cars</h4>
                            <div class="form-group">
                                <textarea class="form-control" rows="3">Specialized removal of flood and hurricane damaged vehicles</textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-success" onclick="savePage('services')">üíæ Save Services</button>
                    <button class="btn" onclick="addService()">‚ûï Add Service</button>
                </div>
            </div>

            <!-- Locations Section -->
            <div id="locations" class="section">
                <h2>üìç Service Locations</h2>
                <div class="card">
                    <h3>Areas We Service</h3>
                    <p>We currently service all major cities in South Florida:</p>
                    <div class="grid">
                        <div>Miami</div>
                        <div>Miami Beach</div>
                        <div>Coral Gables</div>
                        <div>Aventura</div>
                        <div>Homestead</div>
                        <div>Hialeah</div>
                        <div>Fort Lauderdale</div>
                        <div>Hollywood</div>
                        <div>Pompano Beach</div>
                        <div>Pembroke Pines</div>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-success" onclick="savePage('locations')">üíæ Save Locations</button>
                    <button class="btn" onclick="addLocation()">‚ûï Add Location</button>
                </div>
            </div>

            <!-- Contact Section -->
            <div id="contact" class="section">
                <h2>üìû Contact Information</h2>
                <div class="card">
                    <h3>Business Details</h3>
                    <div class="form-group">
                        <label>Business Phone</label>
                        <input type="tel" class="form-control" value="(305) 534-5991">
                    </div>
                    <div class="form-group">
                        <label>Business Email</label>
                        <input type="email" class="form-control" value="buyjunkcarmiami@gmail.com">
                    </div>
                    <div class="form-group">
                        <label>Business Address</label>
                        <input type="text" class="form-control" value="122 South Miami Avenue, Miami, FL 33130">
                    </div>
                    <div class="form-group">
                        <label>License Number</label>
                        <input type="text" class="form-control" value="TI0105">
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-success" onclick="savePage('contact')">üíæ Save Contact Info</button>
                </div>
            </div>

            <!-- Leads Section -->
            <div id="leads" class="section">
                <h2>üë• Lead Management</h2>
                <div class="card">
                    <h3>Recent Leads</h3>
                    <table class="leads-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Name</th>
                                <th>Phone</th>
                                <th>Vehicle</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="leadsTable">
                            <!-- Leads will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="actions">
                    <button class="btn" onclick="exportLeads()">üìä Export Leads</button>
                    <button class="btn" onclick="addLead()">‚ûï Add Lead</button>
                </div>
            </div>

            <!-- Gallery Section -->
            <div id="gallery" class="section">
                <h2>üñºÔ∏è Gallery Management</h2>
                <div class="card">
                    <h3>Website Images</h3>
                    <div class="grid">
                        <div class="card">
                            <img src="../images/AdobeStock_373569463_Preview.jpeg" alt="Junk car removal" class="image-preview">
                            <input type="text" class="form-control" value="Junk car removal Miami" placeholder="Alt text">
                        </div>
                        <div class="card">
                            <img src="../images/939477fa-f5c0-4313-b136-2afa207a675f.JPG" alt="Real pickup" class="image-preview">
                            <input type="text" class="form-control" value="Real junk car pickup Miami" placeholder="Alt text">
                        </div>
                        <div class="card">
                            <img src="../images/junkcars1.webp" alt="Miami service" class="image-preview">
                            <input type="text" class="form-control" value="Miami junk car service" placeholder="Alt text">
                        </div>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-success" onclick="savePage('gallery')">üíæ Save Gallery</button>
                    <button class="btn" onclick="uploadImage()">üì§ Upload Image</button>
                </div>
            </div>

            <!-- Brands Section -->
            <div id="brands" class="section">
                <h2>üöó Car Brands We Buy</h2>
                <div class="card">
                    <h3>Brands List</h3>
                    <div class="grid">
                        <div>Toyota</div>
                        <div>Honda</div>
                        <div>Ford</div>
                        <div>Chevrolet</div>
                        <div>Nissan</div>
                        <div>BMW</div>
                        <div>Mercedes-Benz</div>
                        <div>Audi</div>
                        <div>Hyundai</div>
                        <div>Kia</div>
                        <div>Volkswagen</div>
                        <div>Mazda</div>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-success" onclick="savePage('brands')">üíæ Save Brands</button>
                    <button class="btn" onclick="addBrand()">‚ûï Add Brand</button>
                </div>
            </div>

            <!-- Forms Section -->
            <div id="forms" class="section">
                <h2>üìã Form Management</h2>
                <div class="card">
                    <h3>Contact Form Settings</h3>
                    <div class="form-group">
                        <label>Form Recipient Email</label>
                        <input type="email" class="form-control" value="buyjunkcarmiami@gmail.com">
                    </div>
                    <div class="form-group">
                        <label>Auto-Reply Message</label>
                        <textarea class="form-control" rows="4">Thank you for contacting Miami Junk Car Buyers! We received your request and will contact you within 15 minutes with a cash quote. Our licensed team is ready to pick up your vehicle with free towing.</textarea>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-success" onclick="savePage('forms')">üíæ Save Form Settings</button>
                    <button class="btn" onclick="testForm()">‚úâÔ∏è Test Email</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>
    
    <!-- Editing Indicator -->
    <div id="editingIndicator" class="editing-indicator">‚úèÔ∏è Unsaved Changes</div>

    <script>
        // Admin System JavaScript
        let adminData = JSON.parse(localStorage.getItem('mjc_admin_data')) || {
            leads: [],
            content: {},
            settings: {}
        };

        // Initialize admin
        function initAdmin() {
            updateStats();
            loadLeads();
            loadSavedContent();
            enableAutoSave();
            addCharacterCounters();
            console.log('‚úÖ Miami Junk Car Admin System Loaded');
            console.log('üéØ Features: Content editing, lead management, form integration');
            console.log('üíæ Auto-save enabled for all form fields');
        }

        // Tab Management
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Mark tab as active
            event.target.classList.add('active');
            
            console.log(`üìÑ Switched to ${sectionId} section`);
        }

        // Save page content
        function savePage(page) {
            try {
                let content = {};
                
                if (page === 'home') {
                    content = {
                        title: document.getElementById('homeTitle')?.value || '',
                        metaDesc: document.getElementById('homeMetaDesc')?.value || '',
                        headline: document.getElementById('homeHeadline')?.value || '',
                        subtitle: document.getElementById('homeSubtitle')?.value || ''
                    };
                    
                    console.log('Saving home content:', content);
                }
                
                if (page === 'contact') {
                    const contactSection = document.getElementById('contact');
                    content = {
                        phone: contactSection?.querySelector('input[type="tel"]')?.value || '(305) 534-5991',
                        email: contactSection?.querySelector('input[type="email"]')?.value || 'buyjunkcarmiami@gmail.com',
                        address: contactSection?.querySelector('input[value*="Miami Avenue"]')?.value || '122 South Miami Avenue, Miami, FL 33130',
                        license: contactSection?.querySelector('input[value="TI0105"]')?.value || 'TI0105'
                    };
                    
                    console.log('Saving contact content:', content);
                }
                
                if (page === 'services') {
                    const serviceTextareas = document.querySelectorAll('#services textarea');
                    const services = [];
                    serviceTextareas.forEach((textarea, index) => {
                        const serviceCard = textarea.closest('.card');
                        const serviceTitle = serviceCard?.querySelector('h4')?.textContent || `Service ${index + 1}`;
                        services.push({
                            title: serviceTitle,
                            description: textarea.value
                        });
                    });
                    content = { services };
                    
                    console.log('Saving services content:', content);
                }
                
                if (page === 'gallery') {
                    const imageInputs = document.querySelectorAll('#gallery input[type="text"]');
                    const images = [];
                    imageInputs.forEach((input, index) => {
                        const imgElement = input.parentElement?.querySelector('img');
                        if (imgElement) {
                            images.push({
                                src: imgElement.src,
                                alt: input.value,
                                index: index
                            });
                        }
                    });
                    content = { images };
                    
                    console.log('Saving gallery content:', content);
                }
                
                if (page === 'forms') {
                    const formsSection = document.getElementById('forms');
                    content = {
                        recipientEmail: formsSection?.querySelector('input[type="email"]')?.value || 'buyjunkcarmiami@gmail.com',
                        autoReply: formsSection?.querySelector('textarea')?.value || 'Thank you for contacting Miami Junk Car Buyers!'
                    };
                    
                    console.log('Saving forms content:', content);
                }
                
                // Save to localStorage
                if (!adminData.content) adminData.content = {};
                adminData.content[page] = {
                    ...content,
                    lastUpdated: new Date().toISOString(),
                    savedBy: 'admin',
                    version: (adminData.content[page]?.version || 0) + 1
                };
                
                localStorage.setItem('mjc_admin_data', JSON.stringify(adminData));
                
                // Visual feedback
                const saveButton = document.querySelector(`#${page} .btn-success`);
                const editingIndicator = document.getElementById('editingIndicator');
                
                if (saveButton) {
                    const originalText = saveButton.textContent;
                    saveButton.textContent = '‚úÖ Saved!';
                    saveButton.style.background = '#27ae60';
                    setTimeout(() => {
                        saveButton.textContent = originalText;
                        saveButton.style.background = '';
                    }, 2000);
                }
                
                // Hide editing indicator
                if (editingIndicator) {
                    editingIndicator.style.display = 'none';
                }
                
                // Update all input original values
                const inputs = document.querySelectorAll(`#${page} input, #${page} textarea`);
                inputs.forEach(input => {
                    input.dataset.originalValue = input.value;
                    input.classList.remove('changed');
                    input.classList.add('saved');
                    setTimeout(() => {
                        input.classList.remove('saved');
                    }, 2000);
                });
                
                showNotification(`‚úÖ ${page.charAt(0).toUpperCase() + page.slice(1)} page saved successfully!`);
                console.log(`üíæ Saved ${page} page content:`, content);
                
                // Update stats if needed
                if (page === 'contact') {
                    updateBusinessInfo(content);
                }
                
            } catch (error) {
                console.error('Save error:', error);
                showNotification(`‚ùå Error saving ${page} page: ${error.message}`);
            }
        }
        
        // Load saved content on page load
        function loadSavedContent() {
            try {
                const savedData = JSON.parse(localStorage.getItem('mjc_admin_data') || '{}');
                if (savedData.content) {
                    
                    // Load home content
                    if (savedData.content.home) {
                        const home = savedData.content.home;
                        if (home.title) document.getElementById('homeTitle').value = home.title;
                        if (home.metaDesc) document.getElementById('homeMetaDesc').value = home.metaDesc;
                        if (home.headline) document.getElementById('homeHeadline').value = home.headline;
                        if (home.subtitle) document.getElementById('homeSubtitle').value = home.subtitle;
                    }
                    
                    // Load contact content
                    if (savedData.content.contact) {
                        const contact = savedData.content.contact;
                        const contactSection = document.getElementById('contact');
                        if (contact.phone && contactSection) {
                            const phoneInput = contactSection.querySelector('input[type="tel"]');
                            if (phoneInput) phoneInput.value = contact.phone;
                        }
                        if (contact.email && contactSection) {
                            const emailInput = contactSection.querySelector('input[type="email"]');
                            if (emailInput) emailInput.value = contact.email;
                        }
                        if (contact.address && contactSection) {
                            const addressInput = contactSection.querySelector('input[value*="Miami Avenue"]');
                            if (addressInput) addressInput.value = contact.address;
                        }
                        if (contact.license && contactSection) {
                            const licenseInput = contactSection.querySelector('input[value="TI0105"]');
                            if (licenseInput) licenseInput.value = contact.license;
                        }
                    }
                    
                    console.log('‚úÖ Loaded saved content from localStorage');
                }
            } catch (error) {
                console.log('No saved content to load:', error);
            }
        }
        
        // Update business info
        function updateBusinessInfo(contactData) {
            // Update any displayed business info
            console.log('Business info updated:', contactData);
        }

        // Lead management
        function addLead(name = 'Sample Lead', phone = '(305) 555-0123', vehicle = '2010 Honda Civic') {
            const lead = {
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                name: name,
                phone: phone,
                vehicle: vehicle,
                status: 'new',
                source: 'website',
                notes: '',
                created: new Date().toISOString()
            };
            
            adminData.leads.unshift(lead);
            localStorage.setItem('mjc_admin_data', JSON.stringify(adminData));
            
            loadLeads();
            updateStats();
            showNotification('‚úÖ New lead added successfully!');
        }

        function loadLeads() {
            const tbody = document.getElementById('leadsTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            adminData.leads.slice(0, 10).forEach(lead => {
                const row = `
                    <tr>
                        <td>${lead.date}</td>
                        <td>${lead.name}</td>
                        <td>${lead.phone}</td>
                        <td>${lead.vehicle}</td>
                        <td><span class="status-${lead.status}">${lead.status}</span></td>
                        <td>
                            <button class="btn" onclick="editLead(${lead.id})" style="padding: 6px 12px; font-size: 12px;">Edit</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
            
            console.log(`üìä Loaded ${adminData.leads.length} leads`);
        }

        function updateStats() {
            const totalLeads = adminData.leads.length;
            const newLeads = adminData.leads.filter(lead => lead.status === 'new').length;
            const today = new Date().toDateString();
            const todayLeads = adminData.leads.filter(lead => new Date(lead.created).toDateString() === today).length;
            
            document.getElementById('totalLeads').textContent = totalLeads;
            document.getElementById('newLeads').textContent = newLeads;
            document.getElementById('todayLeads').textContent = todayLeads;
        }

        // Utility functions
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function previewPage(page) {
            const url = page === 'home' ? '/' : `/${page}/`;
            window.open(url, '_blank');
            showNotification(`üëÅÔ∏è Opened ${page} page preview`);
        }

        function exportLeads() {
            const csvContent = "data:text/csv;charset=utf-8," + 
                "Date,Name,Phone,Vehicle,Status,Source\n" +
                adminData.leads.map(lead => 
                    `${lead.date},${lead.name},${lead.phone},${lead.vehicle},${lead.status},${lead.source}`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "miami_junk_car_leads.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('üìä Leads exported successfully!');
        }

        function editLead(leadId) {
            const lead = adminData.leads.find(l => l.id === leadId);
            if (lead) {
                const newStatus = lead.status === 'new' ? 'contacted' : 'completed';
                lead.status = newStatus;
                localStorage.setItem('mjc_admin_data', JSON.stringify(adminData));
                loadLeads();
                updateStats();
                showNotification(`‚úÖ Lead updated to ${newStatus}`);
            }
        }

        function testForm() {
            showNotification('‚úâÔ∏è Form test email sent successfully!');
        }

        function addService() {
            showNotification('‚ûï Add new service functionality');
        }

        function addLocation() {
            showNotification('üìç Add new location functionality');
        }

        function addBrand() {
            showNotification('üöó Add new brand functionality');
        }

        function uploadImage() {
            showNotification('üì§ Image upload functionality');
        }

        // Reset page to defaults
        function resetPage(page) {
            if (confirm(`Are you sure you want to reset the ${page} page to default content?`)) {
                if (page === 'home') {
                    document.getElementById('homeTitle').value = 'Buy Junk Car Miami - We Buy Junk Cars Miami | Free Towing';
                    document.getElementById('homeMetaDesc').value = 'Get instant cash for your junk car in Miami! Free towing, same-day pickup. We buy cars with no title. Call (305) 534-5991 for your quote today.';
                    document.getElementById('homeHeadline').value = 'Buy Junk Car Miami - Top Dollar Paid - Same Day Pickup';
                    document.getElementById('homeSubtitle').value = 'We buy junk cars, damaged cars, and cars with no title in Miami-Dade & Broward County. Get paid TOP CASH on the spot with FREE towing in 30 minutes to 1 hour!';
                }
                
                if (page === 'contact') {
                    const contactSection = document.getElementById('contact');
                    if (contactSection) {
                        const phoneInput = contactSection.querySelector('input[type="tel"]');
                        const emailInput = contactSection.querySelector('input[type="email"]');
                        const addressInput = contactSection.querySelector('input[value*="Miami"]');
                        const licenseInput = contactSection.querySelector('input[value*="TI"]');
                        
                        if (phoneInput) phoneInput.value = '(305) 534-5991';
                        if (emailInput) emailInput.value = 'buyjunkcarmiami@gmail.com';
                        if (addressInput) addressInput.value = '122 South Miami Avenue, Miami, FL 33130';
                        if (licenseInput) licenseInput.value = 'TI0105';
                    }
                }
                
                // Remove from localStorage
                const savedData = JSON.parse(localStorage.getItem('mjc_admin_data') || '{}');
                if (savedData.content && savedData.content[page]) {
                    delete savedData.content[page];
                    localStorage.setItem('mjc_admin_data', JSON.stringify(savedData));
                }
                
                showNotification(`‚úÖ ${page.charAt(0).toUpperCase() + page.slice(1)} page reset to defaults`);
            }
        }

        // Auto-save functionality
        function enableAutoSave() {
            let hasUnsavedChanges = false;
            const editingIndicator = document.getElementById('editingIndicator');
            
            const inputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea');
            inputs.forEach(input => {
                // Store original value
                input.dataset.originalValue = input.value;
                
                input.addEventListener('input', debounce(() => {
                    const isChanged = input.value !== input.dataset.originalValue;
                    
                    if (isChanged) {
                        input.classList.add('changed');
                        input.classList.remove('saved');
                        hasUnsavedChanges = true;
                        editingIndicator.style.display = 'block';
                    } else {
                        input.classList.remove('changed');
                        
                        // Check if any other inputs have changes
                        const hasOtherChanges = Array.from(inputs).some(i => 
                            i !== input && i.value !== i.dataset.originalValue
                        );
                        
                        if (!hasOtherChanges) {
                            hasUnsavedChanges = false;
                            editingIndicator.style.display = 'none';
                        }
                    }
                }, 300));
                
                // Show save feedback when field loses focus
                input.addEventListener('blur', () => {
                    if (input.classList.contains('changed')) {
                        input.classList.add('saved');
                        input.classList.remove('changed');
                        input.dataset.originalValue = input.value;
                        
                        setTimeout(() => {
                            input.classList.remove('saved');
                        }, 2000);
                    }
                });
            });
            
            // Warn about unsaved changes when leaving page
            window.addEventListener('beforeunload', (e) => {
                if (hasUnsavedChanges) {
                    e.preventDefault();
                    e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
                    return 'You have unsaved changes. Are you sure you want to leave?';
                }
            });
        }

        // Debounce function for auto-save
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Character counters
        function addCharacterCounters() {
            const titleInputs = document.querySelectorAll('input[id*="Title"], input[id*="Headline"]');
            const descInputs = document.querySelectorAll('textarea[id*="Desc"], textarea[id*="Subtitle"]');
            
            titleInputs.forEach(input => {
                addCounter(input, 60, 'SEO titles work best under 60 characters');
            });
            
            descInputs.forEach(input => {
                addCounter(input, 160, 'Meta descriptions work best under 160 characters');
            });
        }

        function addCounter(element, maxLength, tip) {
            const counter = document.createElement('small');
            counter.style.cssText = 'display: block; color: #666; font-size: 12px; margin-top: 5px;';
            
            const updateCounter = () => {
                const length = element.value.length;
                counter.textContent = `${length}/${maxLength} characters - ${tip}`;
                counter.style.color = length > maxLength ? '#e74c3c' : length > maxLength * 0.9 ? '#f39c12' : '#666';
            };
            
            element.addEventListener('input', updateCounter);
            element.parentNode.appendChild(counter);
            updateCounter();
        }

        // Form integration - capture form submissions from website
        function captureFormSubmission(formData) {
            const lead = {
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                name: formData.name || 'Website Visitor',
                phone: formData.phone || 'Not provided',
                vehicle: formData.vehicle || 'Not specified',
                status: 'new',
                source: 'contact_form',
                notes: formData.message || '',
                created: new Date().toISOString()
            };
            
            adminData.leads.unshift(lead);
            localStorage.setItem('mjc_admin_data', JSON.stringify(adminData));
            
            console.log('üìã New form submission captured:', lead);
            updateStats();
            loadLeads();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initAdmin);

        // Add some sample leads if none exist
        if (adminData.leads.length === 0) {
            setTimeout(() => {
                addLead('John Smith', '(305) 123-4567', '2008 Toyota Camry');
                addLead('Maria Garcia', '(786) 555-9876', '2005 Honda Accord');
                addLead('Robert Johnson', '(305) 444-7890', '2012 Ford Focus');
            }, 1000);
        }

        // Expose functions globally for form integration
        window.miamiJunkCarAdmin = {
            captureFormSubmission: captureFormSubmission,
            addLead: addLead
        };

        console.log('üî• Miami Junk Car Admin System Ready!');
        console.log('üìä Features: Content editing, lead management, form integration');
    </script>
</body>
</html>